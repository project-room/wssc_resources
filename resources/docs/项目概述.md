## 文书模板编辑与渲染的实现

文书模板编辑需要实现的功能有：根据文书内容制作生成模板，根据案件信息填充模板渲染成文书，模板占位符的编辑与管理。

主要难点是, 办公单位绝大多数使用 microsoft office word, 因此模板的格式需要兼容 microsoft office word. 同时根据案件信息渲染相应的内容.

microsoft office word 在 2007 版之前使用的是 doc 格式文件，该文件格式是微软内部标准格式，外界难以兼容。在2007版后，微软使用由其建立并推动的ooxml文档标准，其中 word使用docx文件.

docx 文件本质上是 zip 压缩包, 文档内容主要存在与压缩包中名为 document.xml 文件中, 内容格式是 xml. 因此兼容/操作 docx 文件主要是兼容
符合 ooxml 标准的 xml 文件格式.

可选方案有:

- 基于网页富文本编辑器实现: 前端编辑器使用网页富文本编辑器, 制作模板时将 docx 内容复制进入编辑器, 由编辑器自动转换成 html 格式, 保留文字及表格样式, 而后在后端将 html 文件进行处理, 将占位符替换为 django 模板标记语言并清除多余的 html 样式标签. 模板渲染时依据案件信息, 由 django 模板引擎填充占位符内容完成渲染, 生成 html 文件. 
    
    > __缺点是网页富文本编辑器与 word 编辑使用体验差距较大, 但是模板渲染易于实现.__

- 基于 microsoft office online 实现: 前端编辑器使用 microsoft office online, 可以提供最原生的 word 编辑体验. 模板渲染时由后端依照 ooxml 标准解析 docx 文件, 依据案件信息充 docx 文件中的占位符内容, 最后完成渲染, 生成 docx 文件. 

    > __优点是编辑体验最好, 客户不需要安装 microsoft office 软件, 缺点是 microsoft office online 服务需要使用两台独立 windows server 服务器, 其中一台为域控制服务器并且不能安装其他软件/服务.__

- 基于 html5 onlyoffice 实现: 前端编辑器使用由 html5 实现的 onlyoffice, 可以提供最接近 microsoft office 的编辑体验. 制作模板时则由用户或管理员在本地通过 microsoft office word 编辑并上传至系统. (模板编辑需要用到插入书签功能, 而 onlyoffice 尚不支持). 模板渲染时依旧由后端依照 ooxml 标准解析 docx 文件, 填充占位符内容后生成 docx 文件. 

    > __优点是客户不需要安装任何软件, 编辑体验好, 支持插件添加其他功能. 缺点是不能在线制作模板.(更新: onlyoffice 宣称 5.2 版本之后支持书签功能, 届时可以在线制作模板.)__

- 基于 PageOffice 实现: 前端编辑器使用 PageOffice 实现, 基本上是调用客户本地 office 软件, 模板渲染方式与前两个方案相同. 

    > __优点是编辑体验好, 可以在线制作模板, 缺点是客户本地需要安装 office 软件(?).__
